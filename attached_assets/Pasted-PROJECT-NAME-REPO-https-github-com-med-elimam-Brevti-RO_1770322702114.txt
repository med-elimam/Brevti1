PROJECT NAME: بريفتي
REPO: https://github.com/med-elimam/Brevti

ROLE:
You are a senior full-stack engineer. Objective: implement a stable content system based on my provided lesson titles ONLY (no crawling, no external websites, no PDFs, no OCR). The app must work reliably on mobile through Expo Go and later be ready for APK/IPA.

STRICT RULES:
- Do NOT crawl or fetch any external website (NO RIMBAC, NO internet scraping).
- Do NOT add placeholder lesson content. Only create lesson records with titles and empty body fields that I will fill later.
- Keep existing navigation working. Don’t break screens.
- All UI must stay Arabic by default.
- Footer text exists globally: "Mohamed el imam" but MUST be small and never cover buttons (fix overlap).
- All network calls in the Expo client must use getApiUrl() and talk only to our backend endpoints. No direct external calls.

GOAL:
Replace the current "fetch external lessons" logic with a local database-driven content system.

DATA MODEL:
Create/ensure SQLite database (server-side):
Path: ./data/app.db

Tables:
1) subjects:
- id (PK)
- key (unique, e.g. "math", "pc", "svt", "islam", "fr")
- name_ar (Arabic label shown in UI)

2) lessons:
- id (PK)
- subject_key (FK-like, string)
- title (original title, French or Arabic)
- language ("fr" or "ar")
- order_index (int)
- content_original (TEXT, initially empty)
- explanation_ar (TEXT, initially empty)
- createdAt

API ENDPOINTS (backend only):
- GET /api/subjects
  returns fixed subjects list in Arabic.

- GET /api/lessons?subject_key=...
  returns lessons for the subject ordered by order_index.

- GET /api/lesson/:id
  returns lesson detail.

- POST /api/lesson/:id
  admin update endpoint to save lesson content_original and explanation_ar (protect using ADMIN_TOKEN header).

- POST /api/explain
  Input: { lessonId }
  Behavior:
    - Load lesson content_original. If empty: return Arabic error "محتوى الدرس غير مُدخل بعد."
    - Call OpenAI with model from OPENAI_MODEL (default gpt-5.2 if set, otherwise gpt-4.1-mini fallback) to generate:
      explanation_ar + key_points + exercises (all Arabic)
    - Save explanation_ar in DB.
    - Return JSON.

IMPORTANT: AI must only use the provided lesson content_original. If empty or insufficient, it must refuse clearly in Arabic.

ENV VARS (deployment secrets already exist):
- OPENAI_API_KEY
- OPENAI_MODEL (set to gpt-5.2)
- ADMIN_TOKEN
- NODE_ENV=production

SEED DATA (create once, idempotent):
Subjects (Arabic labels exactly):
- math: "الرياضيات"
- pc: "الفيزياء والكيمياء"
- svt: "العلوم الطبيعية"
- islam: "التربية الإسلامية"
- fr: "اللغة الفرنسية"

Lessons titles to insert (order_index starts at 1 per subject):

A) math (language=fr):
1 NOMBRES REELS ET OPERATIONS
2 ORDRE, INTERVALLES ET VALEURS ABSOLUE
3 RACINES CARREES
4 CALCUL LITTERAL
5 EQUATIONS ET INEQUATIONS
6 VECTEURS DU PLAN
7 REPERES DU PLAN
8 EQUATIONS DE DROITES
9 SYSTEMES D’EQUATIONS ET D’INEQUATIONS
10 PROJECTION DANS LE PLAN
11 THEOREME DE THALES
12 TRANSFORMATIONS DANS LE PLAN
13 TRIGONOMETRIE
14 FONCTIONS AFFINES
15 PROBABILITES
16 PYRAMIDE
17 CONE DE REVOLUTION
18 LEXIQUE

B) pc (language=fr):
1 LES MATERIAUX
2 REACTIONS CHIMIQUES
3 PREPARATION D’UNE SOLUTION
4 SOLUTIONS ACIDES, BASIQUES ET NEUTRES
5 MASSE, VOLUME ET POIDS
6 EQUILIBRE D’UN SOLIDE SOUMIS A DEUX FORCES
7 RESISTANCE ELECTRIQUE
8 PUISSANCE ET ENERGIE ELECTRIQUE
9 REFLEXION ET REFRACTION DE LA LUMIERE
10 LES LENTILLES MINCES

C) svt (language=fr):
1 ORGANISATION GÉNÉRALE DE LA CELLULE
2 REPRODUCTION CHEZ L’HOMME
3 SYSTÈME NERVEUX ET MOTRICITÉ
4 ROCHES MAGMATIQUES ET MÉTAMORPHIQUES
5 ÉCOLOGIE

D) islam (language=ar):
1 تعريف علم التوحيد واهميته ومكانته
2 حدوث الكون أدلته النقلية والعقلية
3 خلق الإنسان واستخلافه في الأرض
4 أدلة الصفات الواجبة في حق اللّٰه تعالى
5 الجائز والمستحيل في حق اللّٰه تعالى
6 الرسل (صفاتهم، والحكمة من بعثتهم)
7 معجزات الرسل والفرق بينها وبين غيرها من الخوارق
8 تكامل الرسالات السماوية وختمها برسالة محمد رسول اللّٰه صلى اللّٰه عليه وسلم
9 سورة النور من الآية 1 إلى الآية10
10 سورة النور من الآية 11 إلى الآية 20
11 سورة النور من الآية 21 إلى الآية 26
12 سورة النور من الآية 27 إلى الآية 31
13 سورة النور من الآية 32 إلى الآية 38
14 سورة النور من الآية 39 إلى الآية 44
15 سورة النور من الآية 45 إلى الآية 52
16 سورة النور من الآية 53 إلى الآية 57
17 سورة النور من الآية 58 إلى الآية 60
18 سورة النور من الآية 61 إلى الآية 64
19 حرمة الغش والخديعة والتحايل
20 تحريم الغلول والرشوة
21 الظلم والاحتقار
22 الكبر والعجب ورؤية الفضل على الغير
23 الأمر بحفظ اللسان وبقية الجوارح
24 وسائل التسلية وفق الضوابط الشرعية
25 نزول القرآن منجما والحكمة منه
26 اسباب النزول
27 المكي و المدني ( أهدافهما وخصائصهما)
28 التفسير و مناهجه
29 ترجمة لبعض المفسرين
30 بعض المعذبين في سبيل اللّٰه
31 السفارة في الإسلام من خلال جعفر
32 الزوجة وأثرها في الدعوة من خلال خديجة بنت خويلد
33 الدعوة والتعليم من خلال مصعب بن عمير
34 التضحية في سبيل الإسلام من خلال صهيب الرومي
35 مراجعة عامة للبيع
36 بيع الغائب
37 البيع على البرنامج
38 المزاد العلني (صفته - شروطه - حكمه)
39 بيع الثمار والزروع
40 العيوب في البيع
41 السلم
42 الهبة والصدقة
43 الحبس والوقف
44 العارية و الوديعة
45 النكاح حكمه - وحكمته - ومقدماته
46 أركان النكاح وشروطه
47 النساء المحرمات
48 النفقة والحضانة
49 الطلاق والعدة والارتجاع
50 الظهار والخلع
51 الإيلاء واللعان
52 الأنكحة الفاسدة
53 الأيمان والنذور

E) fr (language=fr):
1 Module I: discours explicatif - Séquence 1 : C’est surprenant !
2 Séquence 2 : Qu’est-ce qui s’est passé et comment cela est arrivé ?
3 Séquence 3 : Qu’est-ce que c’est et comment ça fonctionne ?
4 Séquence 4 : Je choisirais plutôt…
5 Module 2: discours argumentatif - Séquence 5 : Pour ma part, voila ce que je pense.
6 Séquence 6 : Je ne suis pas du même avis !
7 Séquence 7 : On est d’accord ?
8 Séquence 8 : Quel métier choisir ?

FRONTEND CHANGES:
- Remove/disable any “external lessons fetch” (the error: Failed to fetch external lessons).
- Subject screen must load lessons using GET /api/lessons?subject_key=...
- Lesson detail screen:
  - show lesson title
  - show content_original (if empty show Arabic: "هذا الدرس لم يتم إدخال محتواه بعد.")
  - show explanation_ar (if exists)
  - button: "شرح الدرس بالذكاء الاصطناعي" calls POST /api/explain with lessonId
  - If content is empty, show message and do not call AI.
- Add a simple admin-only editor screen OR reuse existing Admin screen:
  - list lessons
  - edit content_original in textarea
  - save using POST /api/lesson/:id with ADMIN_TOKEN.

NETWORK FIX REQUIREMENT:
- Ensure getApiUrl() works on Replit + Expo Go mobile:
  - It must use the same deployed domain, HTTPS, no hardcoded port 5000 on client.
  - Client should call relative /api/... when running web, and absolute when mobile.
- Backend should expose API on a single public port (Replit external :80). Internally it can listen on process.env.PORT.

DELIVERABLES:
1) Implement DB + seeding (idempotent).
2) Implement endpoints above with TS types.
3) Update frontend to use backend only.
4) Ensure no “Network request failed” on phone.
5) Adjust footer size to avoid overlap.
6) Provide exact run commands for Replit:
   - install
   - dev
   - start (prod)

START:
Inspect the repo, locate server entry and current lessons fetching logic, then implement the changes end-to-end until it runs.